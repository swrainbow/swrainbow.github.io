---
title: vite-预构建
tags: []
categories: []
---
## 为什么需要预构建
- vite 是基于浏览器原生ES模块规范实现的Dev Server， 不论是应用代码，还是第三方依赖的代码，理应符合ESM规范。但是第三方打包规范，还有相当多的第三方库没有ES版本。所以我们需要将它转化为ESM格式
![](https://strainbow.oss-cn-hangzhou.aliyuncs.com/20240124111033.png)
- 请求瀑布流问题，loadsh-es 库本 身是有 ES 版本产物的，可以在 Vite 中直接运行。但实际上，它在加载时会发出特别多 的请求，导致页面加载的前几秒几都乎处于卡顿状态。在进行依赖的预构建之后， lodash-es 这个库的代码被打包成了一 个文件，这样请求的数量会骤然减少，页面加载也快了许多


## vite基石 Rollup的插件机制
- 仅仅使用 Rollup 内置的打包能力很难满足项目日益复 杂的构建需求。对于一个真实的项目构建场景来说，我们还需要考虑到 模块打包 之外的 问题，比如路径别名(alias) 、全局变量注入和代码压缩
- Rollup 的打包过程中，会定义一套完整的构建生命周期，从开始打包到产物输出，中途 会经历一些标志性的阶段，并且在不同阶段会自动执行对应的插件钩子函数(Hook)。对 Rollup 插件来讲，最重要的部分是钩子函数，一方面它定义了插件的执行逻辑，也就 是"做什么";另一方面也声明了插件的作用阶段，即"什么时候做"，这与 Rollup 本身的 构建生命周期息息相关。
![](https://strainbow.oss-cn-hangzhou.aliyuncs.com/20240125113115.png)
- 对于一次完整的构建过程而言， Rollup 会先进入到 Build 阶段，解析各模块的内 容及依赖关系，然后进入 Output 阶段，完成打包及输出的过程
